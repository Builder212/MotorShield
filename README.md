My version of their code, with a few new features.
